<% kind_labels = {
  "attendance_correction" => "出席修正",
  "attendance_finalize" => "出席確定",
  "attendance_unlock" => "確定解除",
  "attendance_csv_import" => "CSV反映"
} %>
<% status_labels = {
  "pending" => "審査中",
  "approved" => "承認",
  "rejected" => "却下"
} %>
<% status_badges = {
  "pending" => "badge badge-warning",
  "approved" => "badge badge-success",
  "rejected" => "badge badge-error"
} %>

<tr id="<%= dom_id(operation_request) %>">
  <td class="px-4 py-2 text-sm text-gray-500"><%= operation_request.created_at.strftime("%Y-%m-%d %H:%M") %></td>
  <td class="px-4 py-2 text-sm text-gray-700"><%= kind_labels[operation_request.kind] || operation_request.kind %></td>
  <td class="px-4 py-2 text-sm text-gray-700"><%= operation_request.school_class&.name || "-" %></td>
  <td class="px-4 py-2 text-sm text-gray-700"><%= operation_request.user&.name || "-" %></td>
  <td class="px-4 py-2 text-sm text-gray-500"><%= operation_request.reason.presence || "-" %></td>
  <td class="px-4 py-2">
    <span class="<%= status_badges[operation_request.status] || "badge" %>">
      <%= status_labels[operation_request.status] || operation_request.status %>
    </span>
  </td>
  <td class="px-4 py-2 text-right">
    <% if operation_request.status_pending? %>
      <div class="flex flex-col sm:flex-row gap-2 justify-end">
        <%= form_with url: admin_operation_request_path(operation_request), method: :patch do %>
          <input type="hidden" name="decision" value="approve" />
          <input type="text" name="decision_reason" class="input mb-2" placeholder="コメント任意" />
          <button type="submit" class="btn btn-primary w-full">承認</button>
        <% end %>
        <%= form_with url: admin_operation_request_path(operation_request), method: :patch do %>
          <input type="hidden" name="decision" value="reject" />
          <input type="text" name="decision_reason" class="input mb-2" placeholder="却下理由" />
          <button type="submit" class="btn btn-secondary w-full">却下</button>
        <% end %>
      </div>
    <% else %>
      <div class="text-xs text-gray-500">
        <div><%= operation_request.processed_at&.strftime("%Y-%m-%d %H:%M") || "-" %></div>
        <div><%= operation_request.decision_reason.presence || "コメントなし" %></div>
      </div>
    <% end %>
  </td>
</tr>

