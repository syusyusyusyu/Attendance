<%# AdminKit風操作申請: DataGrid、バッジ、フィルター %>
<% kind_labels = {
  "attendance_correction" => "出席修正",
  "attendance_finalize" => "出席確定",
  "attendance_unlock" => "確定解除",
  "attendance_csv_import" => "CSV反映"
} %>
<% status_labels = {
  "pending" => "審査中",
  "approved" => "承認",
  "rejected" => "却下"
} %>
<% status_badges = {
  "pending" => "badge badge-warning",
  "approved" => "badge badge-success",
  "rejected" => "badge badge-error"
} %>

<div class="max-w-6xl mx-auto space-y-6">
  <%# ページヘッダー %>
  <div class="card">
    <div class="card-body">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 rounded-full flex items-center justify-center" style="background-color: var(--color-error-light);">
          <svg class="h-6 w-6" style="color: var(--color-error);" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 12l2 2 4-4"/>
            <path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20z"/>
          </svg>
        </div>
        <div>
          <h1 class="text-2xl font-semibold" style="color: var(--color-text-primary);">操作申請</h1>
          <p class="text-sm mt-1" style="color: var(--color-text-secondary);">教員からの操作申請を管理します。</p>
        </div>
      </div>
    </div>
  </div>

  <%= turbo_frame_tag "operation_requests_results", class: "relative" do %>
  <%= render "shared/frame_loader" %>

  <%# フィルターカード %>
  <div class="card">
    <div class="card-header">
      <h2 class="font-semibold" style="color: var(--color-text-primary);">絞り込み条件</h2>
    </div>
    <div class="card-body">
      <%= form_with url: admin_operation_requests_path,
        method: :get,
        class: "grid grid-cols-1 md:grid-cols-3 gap-4 items-end",
        data: {
          controller: "request-filter",
          action: "change->request-filter#submit input->request-filter#submitDebounced"
        } do |f| %>
        <div>
          <%= f.label :status, "状態", class: "block text-sm font-medium mb-2", style: "color: var(--color-text-primary);" %>
          <%= f.select :status,
            options_for_select(status_labels.map { |key, label| [label, key] }, @status),
            { include_blank: "すべて" },
            class: "input" %>
        </div>
        <div>
          <%= f.label :kind, "種別", class: "block text-sm font-medium mb-2", style: "color: var(--color-text-primary);" %>
          <%= f.select :kind,
            options_for_select(kind_labels.map { |key, label| [label, key] }, @kind),
            { include_blank: "すべて" },
            class: "input" %>
        </div>
        <div class="flex flex-col gap-2">
          <%= f.submit "絞り込む", class: "btn btn-primary w-full" %>
          <% if session[:admin_operation_requests_last_filter].present? %>
            <%= link_to "前回条件",
              admin_operation_requests_path(session[:admin_operation_requests_last_filter]),
              class: "btn btn-secondary w-full" %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <%# データテーブル %>
  <div class="card">
    <div class="card-body p-0">
      <div class="table-container" style="border: none; border-radius: 0;">
        <table class="w-full">
          <thead>
            <tr>
              <th class="px-4 py-3 text-left text-sm font-semibold" style="background-color: var(--color-surface-hover); color: var(--color-text-secondary);">申請日時</th>
              <th class="px-4 py-3 text-left text-sm font-semibold" style="background-color: var(--color-surface-hover); color: var(--color-text-secondary);">種別</th>
              <th class="px-4 py-3 text-left text-sm font-semibold" style="background-color: var(--color-surface-hover); color: var(--color-text-secondary);">クラス</th>
              <th class="px-4 py-3 text-left text-sm font-semibold" style="background-color: var(--color-surface-hover); color: var(--color-text-secondary);">申請者</th>
              <th class="px-4 py-3 text-left text-sm font-semibold" style="background-color: var(--color-surface-hover); color: var(--color-text-secondary);">理由</th>
              <th class="px-4 py-3 text-left text-sm font-semibold" style="background-color: var(--color-surface-hover); color: var(--color-text-secondary);">状態</th>
              <th class="px-4 py-3 text-right text-sm font-semibold" style="background-color: var(--color-surface-hover); color: var(--color-text-secondary);">操作</th>
            </tr>
          </thead>
          <tbody>
            <%= render partial: "row", collection: @requests, as: :operation_request %>
            <% if @requests.empty? %>
              <tr>
                <td colspan="7" class="px-4 py-8 text-center">
                  <div class="empty-state" style="padding: 0;">
                    <div class="empty-state-title">該当なし</div>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <% end %>
</div>
