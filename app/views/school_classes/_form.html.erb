<% schedule = @school_class.schedule || {} %>
<% day_names = %w[日 月 火 水 木 金 土] %>
<% period_value = schedule["period"] || SchoolClass.period_for_times(schedule["start_time"], schedule["end_time"]) %>
<% room_options = SchoolClass::ROOM_OPTIONS %>
<% semester_options = SchoolClass::SEMESTER_OPTIONS %>

<div class="space-y-6">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <%= f.label :name, "クラス名", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= f.text_field :name, class: "input", required: true %>
    </div>
    <div>
      <%= f.label :room, "教室", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= f.select :room,
        options_for_select(room_options, @school_class.room),
        { include_blank: "教室を選択" },
        class: "input",
        required: true %>
    </div>
    <div>
      <%= f.label :subject, "科目", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= f.text_field :subject, class: "input", required: true %>
    </div>
    <div>
      <%= f.label :semester, "学期", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= f.select :semester,
        options_for_select(semester_options, @school_class.semester),
        { include_blank: "学期を選択" },
        class: "input",
        required: true %>
    </div>
    <div>
      <%= f.label :year, "年度", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= f.number_field :year, class: "input", required: true, min: 2000 %>
    </div>
    <div>
      <%= f.label :capacity, "定員", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= f.number_field :capacity, class: "input", required: true, min: 1 %>
    </div>
  </div>

  <div>
    <%= f.label :description, "説明", class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= f.text_area :description, rows: 3, class: "input" %>
  </div>

  <div class="border border-gray-200 rounded-lg p-4">
    <h3 class="text-sm font-medium text-gray-700 mb-3">通常スケジュール</h3>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
      <div>
        <%= label_tag :schedule_day_of_week, "曜日", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= select_tag "school_class[schedule_day_of_week]",
          options_for_select(day_names.map.with_index { |label, idx| [label, idx] }, schedule["day_of_week"]),
          include_blank: "未設定",
          class: "input" %>
      </div>
      <div>
        <%= label_tag :schedule_period, "時限", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= select_tag "school_class[schedule_period]",
          options_for_select(SchoolClass.period_options, period_value),
          include_blank: "時限を選択",
          class: "input" %>
      </div>
      <div>
        <%= label_tag :schedule_frequency, "頻度", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= select_tag "school_class[schedule_frequency]",
          options_for_select([["毎週", "weekly"], ["隔週", "biweekly"]], schedule["frequency"] || "weekly"),
          class: "input" %>
      </div>
    </div>
    <p class="text-xs text-gray-500 mt-2">授業時間は大阪情報コンピュータ専門学校の時限に固定されています。</p>
  </div>

  <div class="flex items-center space-x-2">
    <%= f.check_box :is_active %>
    <%= f.label :is_active, "運用中", class: "text-sm text-gray-700" %>
  </div>
</div>
