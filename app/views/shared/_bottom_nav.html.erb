<%# Bottom Navigation (SP専用: 640px以下で表示、全ロール対応) %>
<nav class="bottom-nav sm:hidden" aria-label="メインナビゲーション">
  <div class="bottom-nav-container">
    <% if current_user.admin? %>
      <%# 管理者ナビゲーション %>
      <%# ダッシュボード %>
      <%= link_to admin_path, class: "bottom-nav-link #{request.path == admin_path ? 'active' : ''}", "aria-current": (request.path == admin_path ? 'page' : nil) do %>
        <span class="bottom-nav-icon-wrap">
          <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        <span class="bottom-nav-label">管理</span>
      <% end %>

      <%# クラス管理 %>
      <%= link_to school_classes_path, class: "bottom-nav-link #{request.path.start_with?(school_classes_path) ? 'active' : ''}", "aria-current": (request.path.start_with?(school_classes_path) ? 'page' : nil) do %>
        <span class="bottom-nav-icon-wrap">
          <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="9" cy="7" r="4" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M23 21v-2a4 4 0 00-3-3.87" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M16 3.13a4 4 0 010 7.75" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        <span class="bottom-nav-label">クラス</span>
      <% end %>

      <%# 出席確認 %>
      <%= link_to attendance_path, class: "bottom-nav-link #{request.path.start_with?(attendance_path) ? 'active' : ''}", "aria-current": (request.path.start_with?(attendance_path) ? 'page' : nil) do %>
        <span class="bottom-nav-icon-wrap">
          <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2" stroke-linecap="round" stroke-linejoin="round"/>
            <rect x="9" y="3" width="6" height="4" rx="1" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 14l2 2 4-4" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        <span class="bottom-nav-label">出席</span>
      <% end %>

      <%# QRコード発行 %>
      <%= link_to generate_qr_path, class: "bottom-nav-link #{request.path.start_with?(generate_qr_path) ? 'active' : ''}", "aria-current": (request.path.start_with?(generate_qr_path) ? 'page' : nil) do %>
        <span class="bottom-nav-icon-wrap">
          <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="6" height="6"/>
            <rect x="15" y="3" width="6" height="6"/>
            <rect x="3" y="15" width="6" height="6"/>
            <path d="M15 15h6v6h-6z"/>
            <path d="M11 11h2v2h-2z"/>
          </svg>
        </span>
        <span class="bottom-nav-label">QR発行</span>
      <% end %>

      <%# プロフィール %>
      <%= link_to profile_path, class: "bottom-nav-link #{request.path.start_with?(profile_path) ? 'active' : ''}", "aria-current": (request.path.start_with?(profile_path) ? 'page' : nil) do %>
        <span class="bottom-nav-icon-wrap">
          <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="12" cy="7" r="4" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        <span class="bottom-nav-label">プロフィール</span>
      <% end %>

    <% elsif current_user.staff? %>
      <%# 教員/スタッフナビゲーション %>
      <%# ダッシュボード %>
      <%= link_to root_path, class: "bottom-nav-link #{request.path == root_path ? 'active' : ''}", "aria-current": (request.path == root_path ? 'page' : nil) do %>
        <span class="bottom-nav-icon-wrap">
          <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z" stroke-linecap="round" stroke-linejoin="round"/>
            <polyline points="9,22 9,12 15,12 15,22" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        <span class="bottom-nav-label">ダッシュボード</span>
      <% end %>

      <%# クラス管理 %>
      <%= link_to school_classes_path, class: "bottom-nav-link #{request.path.start_with?(school_classes_path) ? 'active' : ''}", "aria-current": (request.path.start_with?(school_classes_path) ? 'page' : nil) do %>
        <span class="bottom-nav-icon-wrap">
          <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="9" cy="7" r="4" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M23 21v-2a4 4 0 00-3-3.87" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M16 3.13a4 4 0 010 7.75" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        <span class="bottom-nav-label">クラス</span>
      <% end %>

      <%# 出席確認 %>
      <%= link_to attendance_path, class: "bottom-nav-link #{request.path.start_with?(attendance_path) ? 'active' : ''}", "aria-current": (request.path.start_with?(attendance_path) ? 'page' : nil) do %>
        <span class="bottom-nav-icon-wrap">
          <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2" stroke-linecap="round" stroke-linejoin="round"/>
            <rect x="9" y="3" width="6" height="4" rx="1" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 14l2 2 4-4" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        <span class="bottom-nav-label">出席</span>
      <% end %>

      <%# QRコード発行 %>
      <%= link_to generate_qr_path, class: "bottom-nav-link #{request.path.start_with?(generate_qr_path) ? 'active' : ''}", "aria-current": (request.path.start_with?(generate_qr_path) ? 'page' : nil) do %>
        <span class="bottom-nav-icon-wrap">
          <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="6" height="6"/>
            <rect x="15" y="3" width="6" height="6"/>
            <rect x="3" y="15" width="6" height="6"/>
            <path d="M15 15h6v6h-6z"/>
            <path d="M11 11h2v2h-2z"/>
          </svg>
        </span>
        <span class="bottom-nav-label">QR発行</span>
      <% end %>

      <%# プロフィール %>
      <%= link_to profile_path, class: "bottom-nav-link #{request.path.start_with?(profile_path) ? 'active' : ''}", "aria-current": (request.path.start_with?(profile_path) ? 'page' : nil) do %>
        <span class="bottom-nav-icon-wrap">
          <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="12" cy="7" r="4" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        <span class="bottom-nav-label">プロフィール</span>
      <% end %>

    <% else %>
      <%# 学生ナビゲーション %>
      <%# ダッシュボード %>
      <%= link_to root_path, class: "bottom-nav-link #{request.path == root_path ? 'active' : ''}", "aria-current": (request.path == root_path ? 'page' : nil) do %>
        <span class="bottom-nav-icon-wrap">
          <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z" stroke-linecap="round" stroke-linejoin="round"/>
            <polyline points="9,22 9,12 15,12 15,22" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        <span class="bottom-nav-label">ダッシュボード</span>
      <% end %>

      <%# QRスキャン %>
      <%= link_to scan_path, class: "bottom-nav-link #{request.path == scan_path ? 'active' : ''}", "aria-current": (request.path == scan_path ? 'page' : nil) do %>
        <span class="bottom-nav-icon-wrap">
          <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="6" height="6"/>
            <rect x="15" y="3" width="6" height="6"/>
            <rect x="3" y="15" width="6" height="6"/>
            <path d="M15 15h6v6h-6z"/>
            <path d="M11 11h2v2h-2z"/>
          </svg>
        </span>
        <span class="bottom-nav-label">QRスキャン</span>
      <% end %>

      <%# 出席履歴 %>
      <%= link_to history_path, class: "bottom-nav-link #{request.path.start_with?(history_path) ? 'active' : ''}", "aria-current": (request.path.start_with?(history_path) ? 'page' : nil) do %>
        <span class="bottom-nav-icon-wrap">
          <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
        </span>
        <span class="bottom-nav-label">出席履歴</span>
      <% end %>

      <%# 通知 %>
      <%= link_to notifications_path, class: "bottom-nav-link #{request.path.start_with?(notifications_path) ? 'active' : ''} relative", "aria-current": (request.path.start_with?(notifications_path) ? 'page' : nil) do %>
        <div class="relative">
          <span class="bottom-nav-icon-wrap">
            <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M13.73 21a2 2 0 0 1-3.46 0" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <% if @unread_notifications_count.to_i > 0 %>
            <span class="bottom-nav-badge" aria-label="未読<%= @unread_notifications_count %>件">
              <%= @unread_notifications_count > 9 ? '9+' : @unread_notifications_count %>
            </span>
          <% end %>
        </div>
        <span class="bottom-nav-label">通知</span>
      <% end %>

      <%# プロフィール %>
      <%= link_to profile_path, class: "bottom-nav-link #{request.path.start_with?(profile_path) ? 'active' : ''}", "aria-current": (request.path.start_with?(profile_path) ? 'page' : nil) do %>
        <span class="bottom-nav-icon-wrap">
          <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="12" cy="7" r="4" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        <span class="bottom-nav-label">プロフィール</span>
      <% end %>
    <% end %>
  </div>
</nav>
