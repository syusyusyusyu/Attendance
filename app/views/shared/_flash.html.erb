<% messages = flash.to_hash.filter_map do |type, message|
  next if message.blank?
  alert_type = type.to_s == "notice" ? "success" : type.to_s == "alert" ? "error" : "info"
  [alert_type, message]
end %>

<% if messages.any? %>
  <div
    class="fixed top-[calc(var(--app-header-height)+1rem)] right-4 left-4 sm:left-auto z-50 w-[min(92vw,24rem)] space-y-2 pointer-events-none"
    aria-live="polite"
    aria-atomic="true"
  >
    <% icon_colors = { "success" => "text-green-600", "error" => "text-red-600", "info" => "text-blue-600" } %>
    <% border_colors = { "success" => "border-green-200", "error" => "border-red-200", "info" => "border-blue-200" } %>
    <% bg_colors = { "success" => "bg-green-50", "error" => "bg-red-50", "info" => "bg-blue-50" } %>

    <% messages.each do |alert_type, message| %>
      <div
        data-controller="toast"
        data-toast-timeout-value="4500"
        class="pointer-events-auto rounded-lg border p-4 shadow-lg <%= bg_colors[alert_type] %> <%= border_colors[alert_type] %> opacity-0 translate-y-2 transition duration-200"
        role="alert"
      >
        <div class="flex gap-3 items-start">
          <div class="<%= icon_colors[alert_type] %> pt-0.5">
            <% if alert_type == "success" %>
              <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="9" />
                <path d="M9 12l2 2 4-4" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            <% elsif alert_type == "error" %>
              <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="9" />
                <path d="M15 9l-6 6M9 9l6 6" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            <% else %>
              <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="9" />
                <path d="M12 11v5" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M12 7h.01" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            <% end %>
          </div>
          <div class="flex-1 text-sm text-gray-800 whitespace-pre-wrap">
            <%= message %>
          </div>
          <button
            type="button"
            class="text-gray-500 hover:text-gray-700 -mr-1 -mt-1 p-2"
            data-action="toast#close"
            aria-label="閉じる"
          >
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 6 6 18" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M6 6l12 12" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
        </div>
      </div>
    <% end %>
  </div>
<% end %>
