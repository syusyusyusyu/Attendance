<%# AdminKit風トースト: 右上、aria-live対応 %>
<% messages = flash.to_hash.filter_map do |type, message|
  next if message.blank?
  alert_type = type.to_s == "notice" ? "success" : type.to_s == "alert" ? "error" : "info"
  [alert_type, message]
end %>

<% if messages.any? %>
  <div
    class="fixed top-[calc(var(--app-header-height)+1rem)] right-4 left-4 sm:left-auto z-50 w-[min(92vw,24rem)] space-y-2 pointer-events-none"
    aria-live="polite"
    aria-atomic="true"
  >
    <% icon_colors = {
      "success" => "text-[var(--color-success)]",
      "error" => "text-[var(--color-error)]",
      "info" => "text-[var(--color-info)]"
    } %>
    <% bg_colors = {
      "success" => "bg-[var(--color-success-light)]",
      "error" => "bg-[var(--color-error-light)]",
      "info" => "bg-[var(--color-info-light)]"
    } %>
    <% border_colors = {
      "success" => "border-[var(--color-success)]/20",
      "error" => "border-[var(--color-error)]/20",
      "info" => "border-[var(--color-info)]/20"
    } %>

    <% messages.each do |alert_type, message| %>
      <div
        data-controller="toast"
        data-toast-timeout-value="4500"
        class="pointer-events-auto border p-4 shadow-lg <%= bg_colors[alert_type] %> <%= border_colors[alert_type] %> opacity-0 translate-y-2 transition duration-200"

        role="alert"
      >
        <div class="flex gap-3 items-start">
          <div class="<%= icon_colors[alert_type] %> pt-0.5 flex-shrink-0">
            <% if alert_type == "success" %>
              <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="9" />
                <path d="M9 12l2 2 4-4" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            <% elsif alert_type == "error" %>
              <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="9" />
                <path d="M15 9l-6 6M9 9l6 6" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            <% else %>
              <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="9" />
                <path d="M12 11v5" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M12 7h.01" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            <% end %>
          </div>
          <div class="flex-1 text-sm text-[var(--color-text-primary)] whitespace-pre-wrap font-medium">
            <%= message %>
          </div>
          <button
            type="button"
            class="text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)] -mr-1 -mt-1 p-2 rounded-lg hover:bg-black/5 transition-colors"
            data-action="toast#close"
            aria-label="閉じる"
          >
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 6 6 18" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M6 6l12 12" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
        </div>
      </div>
    <% end %>
  </div>
<% end %>
