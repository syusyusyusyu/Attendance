あなたはシニアUIエンジニア兼デザインシステム実装者です。
対象：RoR出席管理システム（Rails 8 + Hotwire + PostgreSQL）。QRコード＋位置情報（ジオフェンス）で出席を登録し、教員・学生・管理者の3ロールで運用する学校向けWebアプリ。
目的：メディアフロンティア展示（プレゼン兼README）に耐える「2026モダン」なUIへ刷新する。ただし機能・設計思想・画面構造（Hotwire/Turbo中心）は維持し、UI/UXの見た目と操作性を段階導入で改善する。

# 最重要ルール（絶対遵守）
1) UIに表示される日本語の文言（メニュー名、ページタイトル、ボタン、入力ラベル、説明文、バッジ文言など）は勝手に英訳・言い換え・要約して変更しない。
2) 既存の日本語文言が未確定の箇所に新規文言を追加する場合も、日本語で追加し、既存トーン（丁寧/ですます等）を崩さない。
3) 文言変更が良さそうに見えても、勝手に変えない。提案はコメントとして残してよいが、デフォルトは現状維持。

# 0. 作品紹介文（README/プレゼン）との整合（齟齬禁止）
このプロジェクトは以下の説明と矛盾しないUI/IA/画面構成を持つこと：
- 「RoR出席管理システム (Rails 8 + Hotwire + PostgreSQL)」
- 「QRコードと位置情報で、出席をもっとスマートに」
- QRコードによる出席登録と位置情報認証（ジオフェンス）を融合
- 教員・学生・管理者の3ロール運用
- 承認ワークフロー（出席修正/確定/解除は管理者承認を必須化）＋監査ログで実運用に耐える
- 展示のデモの流れ：
  1. 教員ログイン → QRコード発行
  2. 学生ログイン → QRスキャン → 出席完了
  3. 出席管理画面でリアルタイム確認
  4. レポート画面で出席率・要注意者を確認
- 主要機能：
  - QR出席（署名付きトークン）
  - 位置情報認証（OIC校内 半径50m、精度上限150m）
  - 入室/退室記録（2回スキャンで滞在時間・早退判定）
  - 出席申請（欠席/遅刻/公欠 → 教員承認）
  - 監査ログ（全操作、CSV）
  - レポート（週次/日次推移、要注意者、期末PDF/CSV）
  - 通知（メール/LINE/Push）
- OIC運用設定（大阪情報コンピュータ専門学校）：
  - 時限：1限 09:10-10:40 / 2限 10:50-12:20 / 3限 13:10-14:40 / 4限 14:50-16:20 / 5限 16:30-18:00
  - 住所：大阪府大阪市天王寺区上本町6-8-4
  - 校内半径：50m（ジオフェンス）
  - 精度上限：150m
  - 出席ポリシー（デフォルト）：
    遅刻判定 20分 / 出席締切 20分 / 最低出席率 80% / 警告欠席数 3回 / 警告出席率 70%

# 1. 視覚リファレンス（AdminKit風SaaSダッシュボードを強く意識）
添付スクリーンショット（AdminKit系）をUIの雰囲気として採用する：
- 左：濃紺〜ダークグレーの固定サイドバー（アイコン＋日本語ラベル、アクティブは青系ハイライト＋左インジケータ）
- 上：ライト背景のトップバー（検索ボックス、通知ベル、ユーザーメニュー）
- 中央：淡いグレー背景、白いカード群、薄い境界線、控えめな影、余白広め
- KPIカード：タイトル＋大きい数値＋差分バッジ＋右上丸いアイコンバッジ
- チャートカード（折れ線/面）＋補助カード
- テーブル：ヘッダー薄グレー、行間ゆったり、ステータスはピルバッジ
- 角丸：10〜14px相当、彩度低めで上品、UI密度は低めで読みやすい

# 2. 技術前提（Rails 8 + Hotwire + Tailwind + Stimulus）
- Rails 8 + Hotwire（Turbo Frame/Stream）でリアルタイム更新、画面遷移最小化
- Tailwind CSS（ユーティリティ）
- Stimulusで最小限のJS
- PostgreSQL
- 認証：has_secure_password（bcrypt）
- QR署名：MessageVerifier（署名・改ざん検知）、5分で失効
- QRスキャン：BarcodeDetector + jsQR（フォールバック付き）
- 位置情報：Geolocation API + ジオフェンス判定（半径50m、精度上限150m）
- レート制限：クラス10回/分、学生6回/分
- 不正検知：失敗多発/IP集中/トークン共有検知 → 教員通知
- 承認ワークフロー：出席修正/確定/解除は管理者承認必須
- 監査ログ：IP/ブラウザ付き記録、CSV出力

# 3. 現行UXの強み（維持して進化）
- Turbo Frame/Streamで一覧/詳細を部分更新し、ドロワーで遷移最小化
- モバイル最小タップ領域44px確保
- 右上トースト（成功/エラー/情報）
- テーブル中心の管理UI（ただしSPはカード化を導入して改善）

# 4. 画面一覧（文言は変えない）
未ログイン：
- ログイン
- 利用規約 / プライバシー / データ保持ポリシー

学生：
- ダッシュボード
- QRコードスキャン
- 出席履歴
- 出席申請
- 通知
- プロフィール

教員/スタッフ：
- ダッシュボード
- クラス管理
- 出席確認（クラス出席管理）
- 出席申請（承認側）
- 出席変更ログ
- QRコード発行
- QRスキャンログ
- レポート

管理者：
- 管理者ダッシュボード
- ユーザー管理
- ロール/権限
- 操作申請

# 5. 情報設計（AdminKit風IA）—日本語ラベル固定
## 5.1 学生
- SPは下部ナビ（Bottom Nav）固定：以下の日本語ラベルをそのまま表示
  1) ダッシュボード
  2) QRコードスキャン
  3) 出席履歴
  4) 通知
  5) プロフィール
- PC/タブレットは左サイドバーでも良いが項目は少なく保つ

学生サイドバー（PC時・表示するなら）：
【学生】
- ダッシュボード
- QRコードスキャン
- 出席履歴
- 出席申請
- 通知
【アカウント】
- プロフィール
【ヘルプ】
- ご利用ガイド
- 利用規約 / プライバシー / データ保持ポリシー

## 5.2 教員/スタッフ
教員/スタッフサイドバー：
【ダッシュボード】
- ダッシュボード
【クラス】
- クラス管理
【出席】
- 出席確認（クラス出席管理）
- 出席申請（承認側） ※未処理件数バッジ表示
- 出席変更ログ
【QR】
- QRコード発行
- QRスキャンログ
【レポート】
- レポート
【設定】
- プロフィール
- 通知設定
【ヘルプ】
- ご利用ガイド
- 利用規約 / プライバシー / データ保持ポリシー

## 5.3 管理者
管理者サイドバー：
【管理】
- 管理者ダッシュボード
【ユーザーと権限】
- ユーザー管理
- ロール/権限
- 操作申請 ※未処理件数バッジ表示
【監査】
- QRスキャンログ（全体）
- 出席変更ログ（全体）※既存がある場合。無いなら追加しない
【システム】
- データ保持ポリシー（表示のみでも可。無いなら追加しない）
【ヘルプ】
- ご利用ガイド
- 利用規約 / プライバシー / データ保持ポリシー

# 6. UIデザイン仕様（AdminKit寄せ、トークン化）
## 6.1 色（主役は青。ただし表示文言は変えない）
- primary：青（主ボタン/強調）
- success/warn/error/info：状態のみで使用（緑/黄/赤/青）
- 背景：淡いグレー
- カード：白、境界線：薄いグレー
- サイドバー：濃紺/ダークグレー
- テキスト：本文は濃いグレー、サブは薄いグレー

## 6.2 角丸・影・枠線
- radius：基本 12px（カード/入力/ボタン）
- shadow：弱（薄い影）
- border：1px（薄い境界線）

## 6.3 余白・密度
- 8px基準スケール（8/12/16/20/24）
- カード内 padding 16〜20、カード間 gap 16〜24
- 行高：テーブル 48〜56px

## 6.4 タイポ
- Roboto / Noto Sans JP 維持
- KPI数値：大きく太い
- 説明文：小さめ＋薄色
- 見出し：600程度

## 6.5 コンポーネント規約
- KPIカード：右上に丸いアイコンバッジ（淡色円）
- ステータス：ピルバッジ（角丸9999px、淡色背景＋濃い文字）
- トースト：右上、aria-live
- ドロワー：PC右 / SP下、フォーカストラップ、ESC閉じ
- ローディング：Turbo領域はスケルトン/インラインを優先。既存「読み込み中…」は段階置換。

# 7. 画面別UI要件（README内容と矛盾しない）
## 7.1 ログイン
- ロゴアイコン＋タイトル（日本語表記は維持）
- メール/パスワード（アイコン付き、パスワード表示切替）
- アカウントタイプ切替（学生/教員）※文言固定
- デモログイン（学生/教員）※文言固定
- 規約/プライバシー/データ保持へのリンク（文言固定）
- PC：2カラム / SP：縦
- 失敗時：エラー文言は既存維持（勝手に変更しない）

## 7.2 学生：ダッシュボード（展示の入口）
- KPIカード：出席率 / 申請待ち / 注意（文言固定）
- クイック導線：QRコードスキャン / 出席履歴 / 出席申請（文言固定）
- 30日出席傾向（クラス別バー）と注意クラス一覧
- 履修クラス一覧（各クラスにQRコードスキャン/履歴ボタン）
- Bento配置＋AdminKit風KPIカードで“短時間で価値が伝わる”

## 7.3 学生：QRコードスキャン（展示の主役）
- フルスクリーン化
- カメラ起動/停止/手入力切替（文言維持）
- 成功時：大きいチェック＋短いアニメ＋「出席完了」等の既存文言（勝手に変更しない）
- 2回目スキャンで退室を記録する仕様をUI上で誤解なく示す（説明文は日本語で、既存に合わせる）
- 位置情報必須の案内：半径50m・精度上限150mの前提を説明（ただし長文にしない）
- 手順/トラブルガイド（文言維持）
- 失敗時：トークン期限切れ（5分）/ 位置情報NG / 精度NG などを分かりやすく（日本語）

## 7.4 学生：出席履歴
- 月間カレンダー（出席/遅刻/欠席/公欠 色分け）
- 日別詳細はドロワー表示（遷移を増やさない）
- CSV/PDF出力（文言維持）

## 7.5 学生：出席申請
- 新規申請フォーム（クラス/日付/種別/理由、定型文ボタン）
- 申請履歴テーブル（ステータスピル、コメント）
- 承認ワークフロー前提（教員承認）をUIで自然に伝える（文言は既存維持）

## 7.6 学生：通知
- 通知一覧を表示し、既読/未読管理が可能
- kindに応じたアイコン（info/warning/success）で視覚的に区別

## 7.7 学生：プロフィール
- 基本情報（氏名/メール/学生ID/パスワード）表示/編集
- 通知設定（メール/LINE/Push）
- Push購読/解除ボタン

## 7.8 教員：ダッシュボード（デモ手順の起点）
- KPI：出席率 / 承認待ち / 注意学生（文言固定）
- 主要導線：クラス管理 / 出席確認 / QRコード発行 / レポート（文言固定）
- 今日の授業カード（QRコード発行/出席確認/進行状況）
- Hotwireでリアルタイム反映する点が伝わるUI（更新ラベル等は日本語）

## 7.9 教員：QRコード発行（デモ手順 1）
- クラス選択 → QR表示
- 有効期限カウントダウン（5分）、自動更新
- 再発行/ダウンロード
- 署名付きトークン（MessageVerifier）を“改ざん検知”として説明（短く日本語）

## 7.10 教員：出席確認（クラス出席管理）（デモ手順 3）
- クラス/日付選択、前後移動：ヘッダー直下に固定
- 選択日のスケジュール表示
- 学生一覧：DataGrid化（検索/絞り込み、ステータス編集）
- 編集時：「修正理由」必須（未入力は保存不可）
- CSVエクスポート/インポート：ツールバーに整理
- 出席ポリシー（遅刻20分/締切20分/最低出席率80%等）は設定パネルで確認可能
- 出席修正/確定/解除は管理者承認が必要な設計をUI上で明確に（日本語）

## 7.11 教員：出席申請（承認側）
- クラス/ステータス絞り込み
- ステータス別タブ（件数）
- 一括承認/却下（チェック＋フローティング操作）
- 行単位の承認/却下
- 承認は教員、最終承認/特権操作は管理者の領域（齟齬を出さない）

## 7.12 教員：出席変更ログ / QRスキャンログ（監査性の見せ場）
- 条件保存・期間・種別・キーワード検索
- サマリー（件数/内訳）
- ログ一覧 → 詳細はドロワー
- IP/ブラウザ情報があることをUIで見せる（日本語）

## 7.13 教員：レポート（デモ手順 4）
- クラス別出席率（バー）
- 欠席/早退が多い学生ランキング
- 日別サマリー（折れ線＋割合バー）
- 週次/日次推移、要注意者、理由分布、学生別推移
- 期末レポート（CSV/PDF）

## 7.14 管理者：管理者ダッシュボード
- ユーザー数/ロール内訳
- 未処理の出席申請・操作申請
- 最近のログ（監査/スキャン）
- 管理者が“最終承認”を担う設計が伝わる

## 7.15 管理者：ユーザー管理 / ロール/権限 / 操作申請
- ユーザー管理：検索/ロール絞り込み、一覧DataGrid、編集/削除、ドロワーで新規/編集
- ロール/権限：ロールカード、表示名/説明編集、権限チェックボックス（カテゴリ別アコーディオンで見やすく）
- 操作申請：ステータス/種別絞り込み、一覧テーブル（承認/却下＋コメント）
- 出席修正/確定/解除の最終承認が管理者側にあることと矛盾しないUI

# 8. システム構成/図（READMEに矛盾しない）
- flowchart LR の構成（User→Rails→Controller/Service/Model→PostgreSQL、User→GPS/Camera、Rails→SendGrid/WebPush/LINE）
- 機能階層図（認証/ダッシュボード/QR出席/出席管理/監査ログ/クラス管理/レポート/通知/管理者機能）
- IPO（ログイン、QR生成、QRスキャン、レポート）
- 画面遷移（/login, /, /scan, /generate-qr, /history, /attendance, /attendance_requests, /reports, /school_classes, /notifications, /profile, /admin）
UI刷新により、これらの構造やURL前提を壊さない。

# 9. 実装物（必須）
(1) Design Tokens
- tokens.css（または同等）：
  - color roles（primary=青、success/warn/error/info、surface、background、outline、text）
  - sidebar tokens（sidebar-bg, sidebar-text, sidebar-active）
  - radius、space、typography、elevation、motion
- lightテーマ優先（darkは可能なら）

(2) AppShell / Navigation / Topbar / BottomNav
- Sidebar（ダーク、セクション見出し、日本語メニュー、バッジ）
- Topbar（検索：placeholderなど日本語、通知ベル：未読バッジ、ユーザーメニュー）
- Student SP：Bottom Nav（上記固定ラベル）

(3) 共通コンポーネント
- Button / Card / IconBadge / StatusPill / Toast / Drawer（PC右+SP下）/ FormField / Skeleton / DataGrid / MobileRowCard / EmptyState

(4) 主要画面の完成度高い置換（まずここ）
- 学生：ダッシュボード、QRコードスキャン、出席履歴（ドロワー日別）
- 教員：QRコード発行、出席確認（クラス出席管理）、出席申請（承認側）、レポート（主要UI）
- 管理者：ユーザー管理、操作申請、ロール/権限（見やすさ改善）

(5) 移行計画（PR分割）
PR1 tokens + base
PR2 AppShell（Sidebar/Topbar/BottomNav）+ Button/Card/StatusPill/Toast
PR3 Drawer + Skeleton（Turbo領域のローディング改善）
PR4 DataGrid（ユーザー管理 or 出席確認で置換成功）
PR5 学生ダッシュボード（KPIカード/チャート枠/クラス一覧）
PR6 QRコードスキャン（フルスクリーン＋位置情報案内＋成功UI）
PR7 教員出席確認（完成）/ 承認/ ログ/ レポート拡張
PR8 管理者権限/申請の仕上げ

# 10. Hotwire/TurboとUXの実装要件
- Turbo Frame更新で、ドロワー/トースト/フォーカス/スクロールが破綻しない
- ローディングはスケルトン/インラインを優先（全面オーバーレイは段階置換）
- ドロワーはTurbo Frame内の詳細/編集と相性良く（右ドロワーが基本）

# 11. アクセシビリティ/品質（必須）
- タップ領域44px、フォーカスリング、キーボード操作
- prefers-reduced-motion対応
- Toast aria-live
- Drawer role=dialog/aria-modal＋フォーカストラップ＋ESC閉じ
- エラーメッセージ/成功表示は既存日本語を維持

# 12. 出力フォーマット（Claude Codeの出力ルール：厳守）
1) 「確認したリポジトリ構成/スタック（Rails 8/Hotwire/Tailwind/Stimulus等）」を短く宣言
2) 「段階移行（PR分割）」提示
3) 実装：ファイルパスごとの差分（diff）または新規ファイル全文
4) 動作確認チェックリスト（SP/PC、Turbo更新、キーボード、reduced-motion）
5) 自己チェック：日本語文言を勝手に英訳/改変していないこと（チェック項目として列挙）

--- 
この条件で、まずPR1〜PR3（tokens/AppShell/Drawer/Skeleton）まで実装し、その後PR4でDataGrid置換を1画面成功させてください。
