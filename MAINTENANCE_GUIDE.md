# 運用保守ガイド（OIC運用）

## 1. バックアップ/復旧
- Renderの自動バックアップを有効化
- 手動バックアップ: `pg_dump` を定期保存
- 復旧手順: バックアップから `psql` でリストア → `bin/rails db:migrate`

## 2. 監視/アラート
- 500/422の頻発を監視
- QRスキャン失敗率の上昇を確認
- 位置情報エラーが多発する場合は端末/権限の案内を見直す

## 3. 定期ジョブ
- 出席確定: `bin/rails attendance:finalize`
- デモデータ更新（必要時）: `bin/rails demo:seed`

## 4. セキュリティ
- `QR_TOKEN_SECRET` は本番で必ず変更
- 管理者アカウントは最小人数で運用
- 位置情報は OIC 校内に固定（変更不可）

## 5. トラブル対応
- 位置情報エラー: 端末の位置情報許可/対応ブラウザを確認
- QRスキャン失敗: 有効期限・授業日・履修の有無を確認
- CSV反映失敗: 申請ログとエラーメッセージを確認

## 6. デプロイ
- Build: `bin/render-build.sh`
- Start: `bundle exec puma -C config/puma.rb`
- 反映後にログイン・QRスキャン・レポート出力を簡易確認

## 7. UI/UXメンテナンス基準
- Tailwind拡張のトークン（ボタン/入力/カード/バッジ/テーブル）は`app/assets/tailwind/application.css`で一元管理し、個別上書きを避ける
- Turbo Frameで部分更新する画面（出席履歴/レポート/申請/ログ/管理画面）は、HTMLレスポンスではなくturbo_streamを優先して実装
- ドロワー（`drawer`コントローラ）でフォームを開閉する場合、閉じるボタンは必ず配置し、成功時はフレームを閉じて一覧を置き換える
- ボタン/リンクは最小44px、入力は16px以上を維持し、モバイルでのズーム発生を防ぐ
