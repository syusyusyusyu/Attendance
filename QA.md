# 展示用 QA

このドキュメントは、学内作品会で想定される質問に速やかに答えられるよう作成した Q&A 集です。
エンジニア、教員、在学生それぞれに向けた技術的・教育的・実務的な回答を含みます。

---

## 1. プロジェクト概要
- **目的**: 出席管理を簡単にすること（QR入室/退室、履歴参照、申請承認）。
- **主要技術**: Ruby on Rails / Tailwind CSS / Hotwire。
- **主要機能**: 認証、クラス/履修管理、QR生成、入室/退室、出席申請、監査ログ、レポート。

---

## 2. 動作／ローカル起動方法（開発者向け）
- 前提: Ruby / Bundler / DB（Postgres 推奨）

```bash
bundle install
bin/rails db:setup
bin/rails server
```

- アセットプリコンパイル（本番相当）

```bash
bin/rails assets:precompile
```

---

## 3. アーキテクチャ概要（技術者向け）
- **MVC**: `app/models`, `app/controllers`, `app/views` に分離。
- **主要モデル**:
  - `User`（教員/学生）
  - `SchoolClass`（授業）
  - `Enrollment`（履修）
  - `AttendanceRecord`（出席）
  - `AttendanceRequest`（出席申請）
  - `ClassSession`（授業回）
- **認証**: セッションベース（`SessionsController`）。
- **QR/Token**: `AttendanceToken` で署名付きトークン発行、`QrSession` を保存。

---

## 4. セキュリティ・プライバシー（教員・管理者向け）
- **個人情報**: 最小限の保存、アクセス制御。
- **認可**: 役割に応じた画面制限。
- **トークン安全性**: 短時間有効 + 署名検証。
- **CSRF / CSP**: Rails標準の対策を適用。

---

## 5. パフォーマンスとスケーラビリティ（技術者向け）
- **負荷点**: QR発行、同時スキャン、出席記録の書き込み。
- **改善案**: Redisキャッシュ、ジョブキュー、インデックス最適化。

---

## 6. テスト・品質保証
- **テスト構成**: `test/` の Minitest（モデル/サービス）。
- **推奨追加**: システムテスト（QRスキャン/申請/確定）。

---

## 7. デプロイ／運用（教員・技術運用向け）
- **対応**: Render / Heroku / VPS。
- **環境変数**: DB接続、`RAILS_MASTER_KEY`、`QR_TOKEN_SECRET`。
- **監視**: ログ収集 + エラー監視を推奨。

---

## 8. UI／UX／アクセシビリティ（学生・先生向け）
- **モバイル対応**: QRスキャンと手入力を両対応。
- **アクセシビリティ**: コントラストとタップ領域を考慮。

---

## 9. よくある質問（FAQ）

### Q: QR を偽造されたら？
A: トークンは短時間有効で署名済み。失効/期限切れは無効です。

### Q: 既存の学務システムと連携できますか？
A: CSV/REST API を追加すれば連携可能です。

---

## 10. デモ用短いスクリプト
1. 学生でログイン → QRをスキャン。
2. 教員画面でリアルタイム反映を確認。
3. レポートで出席傾向を表示。

---

## 11. 典型的な専門家からの想定質問（短答）
- DB正規化: 第3正規形を想定。
- トランザクション: 出席登録はACIDを意識。
- マイグレーション: ダウンタイム最小化で実施。

---

## 12. トラブルシュート
- アクセスできない: `bin/rails server` のログ確認。
- アセットが表示されない: `bin/rails assets:precompile`。
- DB不整合: `bin/rails db:migrate:status`。

---

## 13. 今後の拡張アイデア
- SSO連携、保護者通知、分析ダッシュボード。

---

## 14. 連絡先・コントリビューション
- 関連ファイル: `app/models`, `app/controllers`, `app/services`。
- 追加要望は Pull Request か直接連絡。

---

## 追加: QR本格導入 Q&A

### Q: カメラが使えない端末ではどうする？
A: QR文字列の手入力にフォールバックできます。

### Q: QR_TOKEN_SECRET を変えるとどうなる？
A: 既存のQRトークンはすべて無効になります。

### Q: 重複スキャンはどう扱われる？
A: 既に出席済みの場合は「すでに出席済み」として扱い、スキャンログには duplicate が記録されます。

### Q: 退室はどう記録する？
A: 同じ授業のQRを2回目に読み取ることで退室(チェックアウト)を記録します。

### Q: 早退判定は？
A: 最低出席率に基づき、入室〜退室の滞在時間が不足すると早退になります。

### Q: QRコードは自動更新される？
A: 60秒間隔で自動更新されます。

### Q: 出席申請はできる？
A: 学生が欠席/遅刻/公欠の申請を送り、教員が承認/却下できます。

### Q: 出席確定/自動欠席は？
A: 授業回を確定すると未登録は欠席となります。定期実行は `bin/rails attendance:finalize` を利用します。

### Q: 出席データを配布したい場合は？
A: 出席管理画面からCSVをダウンロードできます(Excel対応のBOM付き)。

### Q: カメラQRスキャン対応ブラウザは？
A: Chromium系(Chrome/Edge/Brave/Opera/Samsung Internet)を推奨。iOS Safari 16+ はjsQRフォールバックで利用可能です。非対応端末は手入力を利用します。

### Q: CSVは期間指定できる？
A: `start_date`/`end_date` を指定して期間出力できます。1日だけなら同日指定です。

### Q: CSVに追加された項目は？
A: 授業回ID、入室時刻、退室時刻、滞在分、申請状況/申請種別/申請理由、QRセッションID、IP、UserAgent、備考です。

### Q: 遅刻や締切の判定はどう決める？
A: クラスごとの出席ポリシーで「遅刻判定(分)」「締切(分)」「開始前許可」「最低出席率」を設定できます。

### Q: QRスキャンの監査ログは見られる？
A: 教員は `/scan-logs` でスキャン結果と出席判定、IP/端末情報を確認できます。

### Q: CSVインポートの形式は？
A: `日付/学生ID/出席状況` が必須で、出席状況は `出席/遅刻/欠席/公欠/早退`。`入室時刻/退室時刻/滞在分` は任意です。

### Q: クラスや名簿はどこで管理する？
A: 教員の「クラス管理」からクラス作成・名簿CSVインポート・履修追加/削除が可能です。

### Q: 休講や補講はどう設定する？
A: クラス詳細画面の「特別日程」で日付単位の休講/補講を登録できます。

### Q: 出席修正の理由は残る？
A: はい。修正時に理由入力が必須で、出席変更ログに記録されます。

### Q: 出席レポートは見られる？
A: `/reports` で期間を指定してクラス別・学生別の出席傾向を確認できます。

### Q: 通知機能はある？
A: `/notifications` で出席更新・休講・遅刻の通知を確認できます。

### Q: QRスキャンのセキュリティは？
A: 分間スキャン上限、許可IP/端末キーワードの制限を設定できます。

### Q: QRスキャン結果は教員画面に反映される？
A: はい。出席管理画面にリアルタイム反映されます。
