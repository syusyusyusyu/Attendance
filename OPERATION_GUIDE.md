# 教員向け運用ガイド
## 1. 授業回の自動生成と特別日程
- クラス作成時に曜日/時限/開始/終了を設定すると授業回が自動生成されます。
- 休講/補講はクラス詳細の「特別日程」から日付単位で設定します。
- 出席確認画面を開く、またはCSV入出力を行うタイミングで授業回が確定します。

## 2. 出席確定と締切運用
- 授業開始 + 締切分を過ぎると「出席確定」が可能になります。
- 確定時、未入力の学生は自動的に欠席として確定されます。
- 確定後の修正は管理者承認が必要です。

## 3. 出席修正と承認フロー
- 教員の修正/確定解除/CSV反映は「操作申請」として管理者に届きます。
- 管理者が承認すると処理が実行され、監査ログに記録されます。
- 変更理由は必須で、履歴として残ります。

## 4. 監査ログの使い方
- `/attendance-logs` で変更履歴を検索・条件保存・CSV出力できます。
- `/scan-logs` でQRスキャンの成功/失敗、端末/IPを確認できます。
- 不正検知アラートはログ詳細から該当データにジャンプします。

## 5. QR運用と不正対策
- QRは自動ローテーションで更新されます。
- 出席ポリシーで許可IP/端末要件/レート制限を設定できます。
- 失敗多発や異常端末は通知に集約されます。

## 6. 定期確定の運用
- `bin/rails attendance:finalize` をCronで定期実行します。
- RenderではCron Jobで毎日定時の実行を推奨します。
- 実行後にダッシュボードの未確定数を確認します。

## 7. 端末登録
- 学生/教員はプロフィールから端末名を編集し、承認申請できます。
- 管理者が承認した端末のみをスキャン許可にする運用が可能です。

## 8. 管理者ダッシュボードの役割
- `/admin` で操作申請、端末承認、ユーザー/権限、API設定を統合管理します。
- 承認/却下の履歴は監査ログに残ります。

## 9. デモ運用
- `bin/rails demo:seed` でデモデータを作成します。
- `bin/rails demo:reset` でデモデータを初期化します。
- Render DB同期は `DEMO_SOURCE_DATABASE_URL=... bin/rails demo:sync` を使います。
- 詳細は `DEMO.md` を参照します。

## 10. 通知チャネル設定
- メール: `SENDGRID_API_KEY` と `MAIL_FROM` を設定し、プロフィールで有効化します。
- LINE: Messaging APIトークンを設定し、ユーザーがLINEユーザーIDを登録します。
- Push: `WEBPUSH_PUBLIC_KEY/PRIVATE_KEY/SUBJECT` を設定し、ブラウザで購読登録します。

## 11. 授業前/中/後のチェックリスト
- 授業前: 授業回/特別日程、QR発行、出席ポリシーを確認します。
- 授業中: QRの更新、スキャン失敗の原因、遅刻/早退の判定を確認します。
- 授業後: 出席確定、申請/修正の承認状況を確認します。

## 12. 困った時の一次対応
- 画面が更新されない場合は再読み込み/再ログインを試します。
- スキャンできない場合はカメラ権限、対応ブラウザ、照明を確認します。
- 解消しない場合は管理者に連絡し、ログを共有します。

## 13. 参考資料
- 詳細な運用保守は `MAINTENANCE_GUIDE.md` を参照します。
